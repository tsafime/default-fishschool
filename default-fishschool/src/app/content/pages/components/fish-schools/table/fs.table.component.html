<div class="m-section">
	<div [hidden]="model.schoolName === ''">
		<h5>{{'FISH_SCHOOL.FILTERS.SCHOOL_NAME' | translate}}: {{ model.schoolName }}</h5>
	</div>
	<div class="example-container mat-elevation-z8">
		<mat-form-field>
			<input matInput type="text" (keyup)="applyFilter($event.target.value)"
				   placeholder="{{'ACTIONS.SEARCH' | translate}}">
		</mat-form-field>
		<table class="table table-bordered table-striped table-hover table-light table-responsive" mat-table matSort
			   matSortActive="menualAvgWeight" matSortDirection="desc" #table matSortDisableClear [dataSource]="dataSource">

			<!-- feedDate Column -->
			<ng-container matColumnDef="feedDate">
				<td mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'feedDate' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">
					{{ headers[0] }}</td>
				<td mat-cell *matCellDef="let row"
					[style.background]="(model.feedDate.format('DD/MM/YYYY') === row.feedDate)? 'lightblue' : ''"
					class="date-width">
					{{row.feedDate}}
				</td>
			</ng-container>

			<!-- age Column -->
			<ng-container matColumnDef="age">
				<td mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'age' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">
					{{ headers[1] }}</td>
				<td mat-cell *matCellDef="let row">
					<mat-form-field floatLabel="never" *ngIf="isFishSchoolReadWrite('UPDATE', 'age'); else display">
						<input matInput type="number" [value]="row.age" [(ngModel)]="row.age" required step=".01"
							   min="0" class="input-number-format">
						<label class="label-number-format">{{row.age | number}}</label>
					</mat-form-field>
					<ng-template #display>{{row.age | number}}</ng-template>
				</td>
			</ng-container>

			<!-- menualAvgWeight Column -->
			<ng-container matColumnDef="menualAvgWeight">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'menualAvgWeight' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">
					{{ headers[2] }}</th>
				<td mat-cell *matCellDef="let row"
					[style.background]="row.menualAvgWeight === true? 'lightgreen': ''"
					class="vertical-align-middle">
					<i class="material-icons" *ngIf="row.menualAvgWeight === true">
						done
					</i>
				</td>
			</ng-container>

			<!-- averageWeight Column -->
			<ng-container matColumnDef="averageWeight">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'averageWeight' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">
					{{ headers[3] }}</th>
				<td mat-cell *matCellDef="let row">
					<mat-form-field floatLabel="never" *ngIf="isFishSchoolReadWrite('UPDATE', 'averageWeight'); else display">
						<input matInput type="number" [value]="row.averageWeight" [(ngModel)]="row.averageWeight"
							   required step=".01" min="0" class="input-number-format">
						<label class="label-number-format">{{row.averageWeight | number}}</label>
					</mat-form-field>
					<ng-template #display>{{row.averageWeight | number}}</ng-template>
				</td>
			</ng-container>

			<!-- quantity Column -->
			<ng-container matColumnDef="quantity">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'quantity' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">
					{{ headers[4] }}</th>
				<td mat-cell *matCellDef="let row">
					<mat-form-field floatLabel="never" *ngIf="isFishSchoolReadWrite('UPDATE', 'quantity'); else display">
						<input matInput type="number" [value]="row.quantity" [(ngModel)]="row.quantity" required
							   step=".01" min="0" class="input-number-format">
						<label class="label-number-format">{{row.quantity | number}}</label>
					</mat-form-field>
					<ng-template #display>{{row.quantity | number}}</ng-template>
				</td>
			</ng-container>

			<!-- totalWeight Column -->
			<ng-container matColumnDef="totalWeight">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'totalWeight' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">
					{{ headers[5] }}</th>
				<td mat-cell *matCellDef="let row">
					<mat-form-field floatLabel="never" *ngIf="isFishSchoolReadWrite('UPDATE', 'totalWeight'); else display">
						<input matInput type="number" [value]="row.totalWeight" [(ngModel)]="row.totalWeight" required
							   step=".01" min="0" class="input-number-format">
						<label class="label-number-format">{{row.totalWeight | number}}</label>
					</mat-form-field>
					<ng-template #display>{{row.totalWeight | number}}</ng-template>
				</td>
			</ng-container>

			<!-- totalGivenFood Column -->
			<ng-container matColumnDef="totalGivenFood">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'totalGivenFood' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">
					{{ headers[6] }}</th>
				<td mat-cell *matCellDef="let row"> {{row.totalGivenFood | number}}</td>
			</ng-container>

			<!-- actualGivenFood Column -->
			<ng-container matColumnDef="actualGivenFood">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'actualGivenFood' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">>
					{{ headers[7] }}</th>
				<td mat-cell *matCellDef="let row">
					<mat-form-field floatLabel="never" *ngIf="isFishSchoolReadWrite('UPDATE', 'actualGivenFood'); else display">
						<input matInput type="number" [value]="row.actualGivenFood" [(ngModel)]="row.actualGivenFood"
							   required step=".01" min="0" class="input-number-format">
						<label class="label-number-format">{{row.actualGivenFood | number}}</label>
					</mat-form-field>
					<ng-template #display>{{row.actualGivenFood | number}}</ng-template>
				</td>
			</ng-container>

			<!-- foodWeight Column -->
			<ng-container matColumnDef="foodWeight">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'foodWeight' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">
					{{ headers[8] }}</th>
				<td mat-cell *matCellDef="let row">
					<mat-form-field floatLabel="never" *ngIf="isFishSchoolReadWrite('UPDATE', 'foodWeight'); else display">
						<input matInput type="number" [value]="row.foodWeight" [(ngModel)]="row.foodWeight" required
							   step=".01" min="0" class="input-number-format">
						<label class="label-number-format">{{row.foodWeight | number}}</label>
					</mat-form-field>
					<ng-template #display>{{row.foodWeight | number}}</ng-template>
				</td>
			</ng-container>

			<!-- food.name Column -->
			<ng-container matColumnDef="food">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'food' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">
					{{ headers[9] }}</th>
				<td mat-cell *matCellDef="let row">
					<!--<mat-form-field floatLabel="never" *ngIf="isFoodReadWrite('UPDATE', 'name'); else display">-->
						<!--<mat-select name="food" #food="ngModel" [(ngModel)]="row.food"
									placeholder="{{'FOOD.FOOD_TYPE' | translate}}" required [compareWith]="compareObjects">
							<option [value]="null" disabled>{{'FOOD.CHOOSE_FOOD_TYPE' | translate}}</option>
							<mat-option *ngFor="let food of foods" [value]="food">{{food.name}}</mat-option>
						</mat-select>-->
						<div style="width: 300px; margin-bottom: 20px;" *ngIf="isFoodReadWrite('UPDATE', 'name'); else display">
							<!-- https://github.com/ng-select/ng-select -->
							<label class="mat-form-field-label">{{'FISH_SCHOOL.FILTERS.SCHOOL_NAME' | translate}}</label>
							<ng-select matInput class="custom"
									   [items]="foods"
									   bindLabel="name"
									   notFoundText="Food type not found"
									   autofocus
									   [required]="true"
									   #food="ngModel"
									   name="food"
									   [selectableGroup]="true"
									   [virtualScroll]="true"
									   [(ngModel)]="row.food">
							</ng-select>
						</div>
					<!--</mat-form-field>-->
					<ng-template #display>{{row.food.name}}</ng-template>
				</td>
			</ng-container>

			<!-- dead Column -->
			<ng-container matColumnDef="dead">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'dead' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">
					{{ headers[10] }}</th>
				<td mat-cell *matCellDef="let row">
					<mat-form-field floatLabel="never" *ngIf="isFishSchoolReadWrite('UPDATE', 'dead'); else display">
						<input matInput type="number" [value]="row.dead" [(ngModel)]="row.dead" required step=".01"
							   min="0" class="input-number-format">
						<label class="label-number-format">{{row.dead | number}}</label>
					</mat-form-field>
					<ng-template #display>{{row.dead | number}}</ng-template>
				</td>
			</ng-container>

			<!-- averageWeight Column -->
			<ng-container matColumnDef="fcr">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'fcr' ? {background: 'rgba(0, 0, 0, 0.74)', color: 'white'} : {background: 'white', color: 'rgba(0, 0, 0, 0.54)'}">
					{{ headers[11] }}</th>
				<td mat-cell *matCellDef="let row"> {{row.fcr | number}}</td>
			</ng-container>

			<tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
			<tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
		</table>
		<span>
			<button class="btn btn-primary" (click)="update()">{{ 'ACTIONS.UPDATE' | translate }}</button>
		</span>
	</div>
</div>
