<div class="m-section">
	<mat-card *ngIf="isInvoiceTableLoading" style="display: flex; justify-content: center; align-items: center">
		<mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
	</mat-card>
	<div class="example-container mat-elevation-z8" [hidden]="isInvoiceTableLoading || ! havingIvoiceRecords">
		<mat-form-field>
			<input matInput type="text" (keyup)="applyFilter($event.target.value)"
				   placeholder="{{'ACTIONS.SEARCH' | translate}}">
		</mat-form-field>
		<table class="table table-bordered table-striped table-hover table-light table-responsive" mat-table matSort multiTemplateDataRows
			   matSortActive="name" matSortDirection="asc" #table matSortDisableClear [dataSource]="dataSource">

			<!-- name Column -->
			<ng-container matColumnDef="name">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'name' ? {background: 'rgba(0, 0, 0, 0.24)', color: 'white'} : {background: 'white', color: 'black'}">
					{{ headers[0] }}</th>
				<td mat-cell *matCellDef="let row">
						<div style="width: 300px" class="mat-form-field" *ngIf="isFoodInvoiceReadWrite('UPDATE', 'name'); else display">
							<!-- https://github.com/ng-select/ng-select -->
							<label class="mat-form-field-label">{{'FISH_SCHOOL.FILTERS.SCHOOL_NAME' | translate}}</label>
							<ng-select matInput class="custom"
									   [items]="foods"
									   bindLabel="name"
									   notFoundText="{{'FOOD.FILTERS.FOOD_NAME_NOT_FOUND' | translate}}"
									   [required]="true"
									   #name="ngModel"
									   name="name"
									   bindValue="name"
									   [multiple]="false"
									   maxSelectedItems="1"
									   [virtualScroll]="true"
									   [(ngModel)]="row.name">
							</ng-select>
						</div>
						<ng-template #display>{{row.name}}</ng-template>
					<ng-template #display>{{row.name}}</ng-template>
				</td>
			</ng-container>

			<!-- quantity Column -->
			<ng-container matColumnDef="quantity">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'quantity' ? {background: 'rgba(0, 0, 0, 0.24)', color: 'white'} : {background: 'white', color: 'black'}">
					{{ headers[1] }}</th>
				<td mat-cell *matCellDef="let row">
					<mat-form-field floatLabel="never" *ngIf="isFoodInvoiceReadWrite('UPDATE', 'quantity'); else display">
						<input matInput type="number" [value]="row.quantity" [(ngModel)]="row.quantity" required
							   step=".01" min="0" class="input-number-format">
						<label class="label-number-format">{{row.quantity | number}}</label>
					</mat-form-field>
					<ng-template #display>{{row.quantity | number}}</ng-template>
				</td>
			</ng-container>

			<!-- receipt Column -->
			<ng-container matColumnDef="receipt">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'receipt' ? {background: 'rgba(0, 0, 0, 0.24)', color: 'white'} : {background: 'white', color: 'black'}">
					{{ headers[3] }}</th>
				<td mat-cell *matCellDef="let row">
					<mat-form-field floatLabel="never" *ngIf="isFoodInvoiceReadWrite('UPDATE', 'receipt'); else display">
						<input matInput type="text" [value]="row.receipt" [(ngModel)]="row.receipt" required>
					</mat-form-field>
					<ng-template #display>{{row.receipt}}</ng-template>
				</td>
			</ng-container>

			<!-- foodDate Column -->
			<ng-container matColumnDef="foodDate">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == 'foodDate' ? {background: 'rgba(0, 0, 0, 0.24)', color: 'white'} : {background: 'white', color: 'black'}">
					{{ headers[4] }}</th>
				<td mat-cell *matCellDef="let row"
					[style.background]="(model.startDate.format('DD/MM/YYYY') === row.foodDate)? 'lightblue' : ''"
					class="date-width">
					{{row.foodDate}}
				</td>
			</ng-container>

			<ng-container *ngFor="let foodName of getFoodColumns(); trackBy: trackByIdentity" matColumnDef="{{foodName}}">
				<th mat-header-cell *matHeaderCellDef mat-sort-header
					[ngStyle]="sort.active == foodName ? {background: 'rgba(0, 0, 0, 0.24)', color: 'white'} : {background: 'white', color: 'black'}">
					{{foodName}}</th>
				<td mat-cell *matCellDef="let row">{{row[foodName]}}</td>
			</ng-container>

			<tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
			<tr mat-row *matRowDef="let element; columns: displayedColumns;" class="example-element-row"></tr>
			<tr mat-row *matRowDef="let row; columns: getFoodColumns()" [ngStyle]="{display: 'none'}"></tr>
		</table>
		<span>
			<button class="btn btn-primary" (click)="update()" [disabled]="validate() && ! isFishSchoolTableLoading">{{ 'ACTIONS.UPDATE' | translate }}</button>
		</span>
	</div>
</div>

